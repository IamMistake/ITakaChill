<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>ITAKA</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
<header>
    <div>LOGO</div>
    <h1>ITAKA MOVIES</h1>
    <div>
        <button>Login</button>
        <button>Register</button>
    </div>
</header>
<h1>Popular Movies</h1>
<main class="js-movies">
    <div class="js-movie">
        <div class="js-movie-info">
            <h4 class="js-movie-title">Openhaimer</h4>
            <div class="js-movie-director">Kiro Kiroski</div>
            <div class="js-movie-genres">
                <div class="js-genre">Fiction</div>
                <div class="js-genre">Fantasy</div>
            </div>
            <div class="js-movie-duration">
                1:30:20
            </div>
            <div>
                <button>Buy Ticker</button>
            </div>
        </div>
    </div>
</main>


<script src="cMovie.js"></script>

<script>
    async function fetchData(pth)
    {
        try
        {
            let response = await fetch(pth);
            return response.json();
        }
        catch (e)
        {
            console.error("Error:", e);
        }
    }

    class UI
    {
        movieElement
        constructor()
        {
            this.movieElement = document.querySelector('.js-movies')
        }

        addEventsForBuyButtons()
        {
            const buttons = document.querySelectorAll(".js-buy-ticket-btn");
            buttons.forEach(button => {
                button.addEventListener("click", ()=>{
                    app.loadMovie(button.dataset.movieId)
                })
            })
        }
    }

    class MovieApp
    {
        movies;
        constructor()
        {
            this.movies = new Map();
        }

        addMovie(movie)
        {
            this.movies.set(movie.id, movie);
        }

        loadMovie(movieId)
        {
            const movie = this.movies.get(parseInt(movieId));
            localStorage.setItem("movie", JSON.stringify(movie))
            window.location.href = "sali.html";
        }

        async  inti()
        {
            const moviesJson = await fetchData("../backend/static/filmovi.json");
            moviesJson.forEach(movieJson => {
                let movie = Movie.getInstanceFromJSON(movieJson);
                app.addMovie(movie)
            })
            render.renderMovies();
            ui.addEventsForBuyButtons()
        }
    }

    class Render
    {
        renderMovies()
        {
            app.movies.forEach((movie,key) =>{
                ui.movieElement.innerHTML += movie.HTMLFormat
            });
        }
    }


    const app = new MovieApp();
    const ui = new UI();
    const render = new Render();
    app.inti()
    console.log(Movie.getInstanceFromLocalStorage())

</script>

</body>
</html>
